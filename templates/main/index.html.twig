{% extends 'base.html.twig' %}

{% block title %}accueil v3{% endblock %}

{% block body %}

<div class="container-fluid body">
    {% if is_granted ('ROLE_USER') %}
        {# TODO: infos date du jour et nom utilisateur connecté, justifiées à droite #}
        {{ include('main/_recherche.sortie.twig') }}
    {%  endif %}

    {# Liste des Sorties #}
    <div class="row">

        {% for sortie in sorties %}
            <div class="col-sm-3 mb-4">
                <div class="card detail">
                    <div class="image-card d-flex justify-content-center">
                        <img src="{{ asset('img/sortie.png') }}" class="img-fluid card-img-top" alt="{{ sortie.nom }}">
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">{{ sortie.nom }}</h5>
                        <p class="card-text">
                            <b>Lieu:</b> {{ sortie.lieu.nom }}<br>
                            <b>Date:</b> {{ sortie.dateHeureDebut|date('d/m/Y à h:m') }}<br>
                            <b>Organisateur:</b>
                            {% if is_granted ('ROLE_USER') %}
                                <a href="{{ path('utilisateur_profil', {'id':sortie.organisateur.id}) }}">
                                {{ sortie.organisateur.nom }}
                                </a>
                            {% else %}
                                {{ sortie.organisateur.nom }}
                            {%  endif %}
                            <br>
                            <b>Inscrits:</b> {{ sortie.participants ? sortie.participants.count() : '' }} / {{ sortie.nbInscriptionsMax }}<br>
                            <b>Etat:</b> {{ sortie.etat.libelle }}
                    </div>

                    <div class="card-body">
                        {% if sortie.etat.libelle!='Annulée' %}
                            {% if is_granted ('ROLE_USER') %}
                                <a href="{{ path('sortie_show', {'id':sortie.id}) }}" class="btn btn-primary d-inline justify-content-center">En savoir +</a>

                                {%  if app.user.id == sortie.organisateur.id %}
                                    <a href="{{ path('sortie_edit', {'id':sortie.id}) }}" alt="modifier ma sortie à {{ sortie.lieu.nom }}" class="btn btn-warning d-inline justify-content-center">Modifier </a>
                                    <a href="{{ path('annuler_sortie', {'id':sortie.id}) }}" alt="annuler {{ sortie.lieu.nom }}" class="btn btn-danger d-inline justify-content-center">Annuler sa sortie </a>

                                {%  endif %}

                                {%  if app.user.id != sortie.organisateur.id %}
                                    <a href="{{ path('ajout_sortie', {'id': sortie.id}) }}"class="d-inline justify-content-center {% if app.user.mesSorties.contains(sortie) %} btn btn-danger "> Se desinscrire{% else %} btn btn-success"> S'inscrire à la sortie{% endif %}</a>
                                {%  endif %}

                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

{% endblock %}